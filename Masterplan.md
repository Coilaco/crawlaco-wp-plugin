# Crawlaco WordPress Plugin Masterplan

## 1. App Overview and Objectives
The **Crawlaco WordPress Plugin** acts as a bridge between a user’s WordPress/WooCommerce website and the **Crawlaco dashboard**. It simplifies communication between the two systems by handling API key generation, data synchronization, and attribute mapping. The plugin ensures seamless integration, enabling users to manage their websites efficiently through the Crawlaco dashboard.

### Key Objectives:
- Simplify the connection process between WordPress/WooCommerce and Crawlaco.
- Automate the generation and management of API keys.
- Enable data synchronization for articles, products, and attributes.
- Provide a user-friendly interface for setup and configuration.

---

## 2. Target Audience
- **Primary Users**: WordPress site owners who use WooCommerce and want to integrate with the Crawlaco dashboard.
- **Secondary Users**: Developers who may extend the plugin for custom use cases.

---

## 3. Core Features and Functionality
### Step 1: WebsiteKey Validation
- Users enter a **WebsiteKey** generated by the Crawlaco dashboard.
- The plugin validates the key by sending a **GET** request to `/websites/plugin/websites/` with `website-key` and `website-address` headers.
- Displays success or error messages based on the response.

### Step 2: Send API Key Metadata
- Generates and sends **WordPress API Key** and **WooCommerce API Key** (if WooCommerce is installed) to the Crawlaco backend.
- Stores API keys securely in the database.
- Displays success or error messages with a retry option.

### Step 3: Fetch Essential Data
- Initiates data fetching by sending a `POST` request to `/websites/plugin/fetch-all/`.
- Polls the task status every 3 seconds using the `taskId`.
- Displays loading messages and handles success/failure scenarios.

### Step 4: Map Product Attributes
- Displays a table for mapping **Size**, **Color**, and **Brand** attributes.
- Sends mapped attributes to `/websites/plugin/meta-data/`.
- Handles WooCommerce detection and skips the step if WooCommerce is not installed.

### Final Step: Completion
- Sends a `PATCH` request to mark the setup as complete.
- Displays a thank-you message and a **“Login to Crawlaco Dashboard”** button.

---

## 4. High-Level Technical Stack Recommendations
### Backend
- **WordPress REST API**: For handling plugin-specific endpoints and interactions.
- **WooCommerce REST API**: For managing product-related data (if WooCommerce is installed).

### Frontend
- **React.js** or **Vue.js**: For a dynamic and responsive admin interface.
- **RTL Support**: Ensure compatibility with Persian language and RTL layouts.

### Database
- **WordPress Database**: Store API keys, plugin settings, and logs securely.

### Security
- **HTTPS**: Ensure all API requests are encrypted.
- **API Key Encryption**: Encrypt API keys before storing them in the database.

---

## 5. Conceptual Data Model
### Key Data Entities:
- **WebsiteKey**: Stores the unique key for connecting to Crawlaco.
- **API Keys**: Stores WordPress and WooCommerce API keys.
- **Mapped Attributes**: Stores user-selected attribute mappings (Size, Color, Brand).
- **Task Status**: Stores task IDs and statuses for polling.

---

## 6. User Interface Design Principles
- **RTL and Persian Language**: Ensure all text and layouts are RTL-compliant and in Persian.
- **Modern Design**: Use a clean, contemporary design with a **white, blue, and purple** color scheme.
- **Multi-Step Form**: Guide users through the setup process with a step-by-step wizard.
- **Admin Menu**: Add a **Crawlaco menu** with submenus for Settings, Status, and Login to Crawlaco Dashboard.

---

## 7. Security Considerations
- **HTTPS**: Use HTTPS for all API requests to ensure secure communication.
- **API Key Encryption**: Encrypt API keys before storing them in the database.
- **Error Logging**: Use WordPress’s default logger for error logging.

---

## 8. Development Phases or Milestones
### Phase 1: Core Setup
- **Objective**: Implement the basic plugin structure, WebsiteKey validation, and a user interface for the setup process.
- **Tasks**:
  - Create the plugin skeleton with activation and deactivation hooks.
  - Add a **Crawlaco menu button** to the WordPress admin dashboard.
  - Create a **simple page** in the WordPress admin dashboard to display the plugin forms (e.g., the multi-step setup wizard).
  - Implement the **GET** request to `/websites/plugin/websites/` for WebsiteKey validation.
  - Add a settings page for entering the WebsiteKey.
  - Display success/error messages based on the validation response.
- **Outcome**: At the end of this phase, the plugin should be installable, and users should be able to:
  - See the **Crawlaco plugin button** in the WordPress admin menu.
  - Access a simple page to view and interact with the plugin forms.
  - Validate their WebsiteKey and proceed to the next step.

### Phase 2: API Key Management
- **Objective**: Automate the generation and management of API keys for WordPress and WooCommerce (if installed).
- **Tasks**:
  1. **Check for WooCommerce**:
     - Use WordPress’s built-in functions (e.g., `is_plugin_active()`) to check if WooCommerce is installed and active.
     - If WooCommerce is **not installed or inactive**, skip the generation of WooCommerce API keys.
  2. **Generate API Keys**:
     - Generate **WordPress API Key** for the current user.
     - If WooCommerce is active, generate **WooCommerce API Key** for the current user.
     - Ensure the API keys are generated **in the background** to avoid blocking the user interface.
  3. **Send API Keys to Crawlaco Backend**:
     - Send the generated API keys to the Crawlaco backend via a `POST` request to `/websites/plugin/meta-data/`.
     - The request body should include:
       ```json
       [
         {
           "key": "WP_SECRET_KEY",
           "value": "<WordPress API Key>",
           "is_password": true
         },
         {
           "key": "WP_USERNAME",
           "value": "<Username of the current user>",
           "is_password": true
         },
         {
           "key": "WC_CONSUMER_KEY",
           "value": "<WooCommerce API Key>",
           "is_password": true
         },
         {
           "key": "WC_CONSUMER_SECRET",
           "value": "<WooCommerce API Secret>",
           "is_password": true
         }
       ]
       ```
     - If WooCommerce is not installed, exclude the WooCommerce-related keys from the request.
  4. **Display Loading Indicator**:
     - Show a **loading spinner** or message (e.g., “Generating API keys…”) while the API keys are being generated and sent.
     - Ensure the user interface remains responsive during this process.
  5. **Handle Success/Failure**:
     - If the API keys are successfully generated and sent, display a success message (e.g., “API keys generated successfully!”).
     - If the process fails, display an error message (e.g., “Failed to generate API keys. Please try again.”) and provide a **retry button**.
  6. **Store API Keys Securely**:
     - Encrypt and store the API keys in the WordPress database for future use.
     - Ensure the keys are only accessible to authorized users.
- **Outcome**: At the end of this phase, the plugin should:
  - Generate and send **WordPress API Key** for the current user.
  - Generate and send **WooCommerce API Key** (if WooCommerce is installed and active).
  - Show a **loading indicator** during the process.
  - Display success or error messages based on the outcome.

### Phase 3: Data Synchronization
- **Objective**: Enable data fetching and synchronization.
- **Tasks**:
  - Implement the `POST` request to `/websites/plugin/fetch-all/` to initiate data fetching.
  - Add task polling logic to check the status of the fetch operation.
  - Display loading messages and handle success/failure scenarios.
- **Outcome**: At the end of this phase, the plugin should be able to fetch essential data from the Crawlaco backend and display the results to the user.

### Phase 4: Attribute Mapping
- **Objective**: Allow users to map product attributes.
- **Tasks**:
  - Add WooCommerce detection logic.
  - Display a table for mapping **Size**, **Color**, and **Brand** attributes.
  - Send mapped attributes to `/websites/plugin/meta-data/`.
  - Handle cases where WooCommerce is not installed.
- **Outcome**: At the end of this phase, the plugin should be able to map product attributes and complete the setup process.

### Phase 5: Polish and Testing
- **Objective**: Ensure the plugin is stable, user-friendly, and ready for deployment.
- **Tasks**:
  - Add RTL and Persian language support.
  - Test the plugin with various WordPress/WooCommerce configurations.
  - Optimize performance and fix any bugs.
- **Outcome**: At the end of this phase, the plugin should be fully functional, polished, and ready for deployment.

### Phase 6: Deployment
- **Objective**: Publish the plugin and provide support.
- **Tasks**:
  - Publish the plugin to the WordPress repository.
  - Add documentation and support links.
  - Monitor user feedback and address issues.
- **Outcome**: The plugin is publicly available, and users can install and use it seamlessly.

---

## 9. Potential Challenges and Solutions
### Challenge 1: WooCommerce Compatibility
- **Solution**: Use WordPress’s built-in functions to detect WooCommerce and handle cases where it’s not installed.

### Challenge 2: Task Polling Performance
- **Solution**: Optimize polling logic and set a timeout to prevent infinite loops.

### Challenge 3: RTL and Persian Support
- **Solution**: Use RTL-compliant CSS frameworks and ensure all text is translatable.

---

## 10. Future Expansion Possibilities
- **Webhook Support**: Add real-time updates via webhooks.
- **Additional Integrations**: Extend the plugin to support other eCommerce platforms or SEO plugins.
- **Advanced Analytics**: Provide insights into data synchronization and performance.

---

## 11. Additional Notes
### Warning Notification
- Until the user completes all four steps, a **warning notification** will be displayed at the top of the WordPress dashboard, reminding the user to activate the Crawlaco plugin.

### Plugin Activation Hook
- Include a **plugin activation hook** in the plugin core. Any code placed in this hook will be executed when the plugin is activated. For example:
  ```php
  register_activation_hook(__FILE__, 'crawlaco_plugin_activation');
  function crawlaco_plugin_activation() {
      // Code to execute on plugin activation
  }

### Logging
- Use WordPress’s default logger for error logging.